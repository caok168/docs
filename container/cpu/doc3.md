# 容器CPU
## LoadAverage：加了CPUCgroup限制，为什么我的容器还是慢？

CPU Cgroup可以限制进程的CPU资源使用，但是CPU Cgroup对容器的资源限制是存在盲点的。

什么盲点？就是无法通过CPU Cgroup来控制Load Average的平均负载。而没有这个限制，就会影响我们系统资源的合理调度，很可能导致我们的系统变得更慢。

# 对Load Average的三点理解
* 不论计算机CPU是空闲还是满负载，Load Average都是Linux进程调度器中可运行队列（Running Queue）里的一段时间的平均进程数目。
* 可运行队列中的进程数目小于CPU个数，这种情况下，单位时间进程CPU Usage相加的平均值应该就是"load average"的值。
* 计算机上的CPU满负载的情况下，计算机上的CPU已经是满负载了，同时还有更多的进程在排队需要CPU资源。这时，“load average”就不能和CPU Usage等同了。

TASK_UNINTERRUPTIBLE是Linux进程状态的一种，是进程为等待某个资源而进入了睡眠的状态，并且这种睡眠的状态是不能被信号打断的。

Load Average=可运行队列进程平均数+休眠队列中不可打断的进程平均数

无论是对disk I/O的访问还是对信号量的访问，都是对Linux系统里的资源的一种竞争。当进程处于D状态时，就说明进程还没有获得资源，这会在应用程序的最终性能上体现出来，也就是说用户会发觉应用的性能下降了。

Cgroups还不能解决D状态的进程。
* 因为Cgroups更多的是以进程为单位进行隔离，而D状态进程是内核中系统全局资源引入的，所以Cgroups影响不了它。
* 所以在生产环境中监控容器的宿主机节点里D状态的进程数量，然后对D状态进程数目异常的节点进行分析，比如磁盘硬件出现问题引起D状态进程数目增加，这时就需要更换磁盘。
