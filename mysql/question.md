## 问题记录

### Buffer Pool相关
* 1. 对于Buffer Pool而言，里面会存放很多的缓存页以及对应的描述数据，那么假设Buffer Pool里的内存都用尽了，已经没有足够的剩余内存来存放缓存页和描述数据了，此时Buffer Pool里就一点内存都没有了吗？还是说Buffer Pool里会残留一些内存碎片呢？
    当然有。因为Buffer Pool大小是自己定的，很可能Buffer Pool划分完全部的缓存页和描述数据块之后，还剩一点点的内存，这一点的内存放不下任何一个缓存页了，所以这点内存就只能放着不能用，这就是内存碎片。
* 2. 如果你觉得Buffer Pool里会有内存碎片的话，怎么做才能尽可能减少Buffer Pool里的内存碎片呢？
    数据库在Buffer Pool中划分缓存页的时候，会让所有的缓存页和描述数据块都紧密的挨在一起，这样尽可能减少内存浪费，就可以尽可能的减少内存碎片的产生了。

### Buffer Pool中的三个链表
* free链表：磁盘上的数据是如何加载到缓存页里去的。
* flush链表：对缓存页修改之后，flush链表是如何用来记载脏数据页的。
* LRU链表：来判断哪些缓存页是不常用的。


### 线上数据库莫名其妙的随机性能抖动
#### 根本原因 2个
* buffer pool的缓存页都满了，此时执行一个SQL查询很多数据，一下子要把很多缓存页flush到磁盘上去，刷磁盘太慢了，就会导致查询语句执行的很慢；
* 执行更新语句的时候，redo log在磁盘上的所有文件都写满了，此时需要回到第一个redo log文件覆盖写，覆盖写的时候就涉及到第一个redo log文件里很多redo log日志对应的更新操作改动了缓存页，那些缓存还没flush到磁盘，此时就必须把那些缓存页flush到磁盘，才能执行后续的更新语句。

#### 解决问题核心点
* 尽量减少缓存页flush到磁盘的频率
* 尽量提升缓存页flush到磁盘的速度

#### 参数设置
* 参数：innodb_io_capacity：这个参数是告诉数据库采用多大的IO速率把缓存页flush到磁盘里去。
* 参数：innodb_flush_neighbors：在flush缓存页到磁盘的时候，会控制把缓存页临近的其他缓存页也刷到磁盘，但是这样有时候会导致flush的缓存页太多了；参数设置为0，禁止刷临近缓存页，这样就把每次刷新的缓存页数量降低到最少了。

